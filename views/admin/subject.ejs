<%- include('partials/header', { title: 'Daftar Subjek', active: 'subject' }) %>

<h1 class="text-2xl font-bold mb-6">Daftar Subjek</h1>

<form action="/admin/subjects" method="GET" class="mb-6 flex gap-2">
    <input
        type="text"
        name="q"
        value="<%= typeof q !== 'undefined' ? q : '' %>"
        placeholder="Cari subjek..."
        class="border p-2 rounded w-full">
    <button class="bg-blue-600 text-white px-4 py-2 rounded">Cari</button>
</form>

<div class="flex justify-between mb-4">
    <h2 class="text-xl font-bold">Daftar Subjek</h2>
    <button onclick="openAddModal()" class="bg-green-600 text-white px-4 py-2 rounded">
        âž• Tambah Subjek
    </button>
</div>

<table class="min-w-full bg-white rounded-lg shadow overflow-hidden">
    <thead class="bg-gray-100 text-left">
        <tr>
            <th class="p-4">No</th>
            <th class="p-4">Nama Kategori</th>
            <th class="p-4">Aksi</th>
        </tr>
    </thead>
    <tbody>
        <% if (subjects.length === 0) { %>
            <tr>
                <td colspan="3" class="text-center p-4 text-gray-500">
                    Belum ada subjek
                </td>
            </tr>
        <% } else { %>
            <% subjects.forEach((subject, index) => { %>
                <tr class="border-t">
                    <td class="p-4"><%= index + 1 %></td>
                    <td class="p-4"><%= subject.name %></td>
                    <td class="p-4">
                        <button
                            class="text-blue-600 hover:underline"
                            data-id="<%= subject.id %>"
                            data-name="<%- subject.name %>"
                            onclick="openEditModal(this)">
                            Edit
                        </button>
                        <a href="/admin/subjects/delete/<%= subject.id %>"
                            onclick="return confirm('Hapus subjek ini?')"
                            class="text-red-600">Hapus</a>
                    </td>
                </tr>
            <% }) %>
        <% } %>
    </tbody>
</table>

<!-- MODAL ADD -->
<div id="addModal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center">
    <div class="bg-white p-6 rounded w-full max-w-md">
        <h3 class="font-bold mb-4">Tambah Subjek</h3>
        <form action="/admin/subjects/add" method="POST">
            <input name="name" required class="w-full border p-2 mb-4 rounded">
            <div class="flex justify-end gap-2">
                <button type="button" onclick="closeAddModal()">Batal</button>
                <button class="bg-blue-600 text-white px-4 py-2 rounded">Simpan</button>
            </div>
        </form>
    </div>
</div>

<!-- MODAL EDIT -->
<div id="editModal" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center">
    <div class="bg-white p-6 rounded w-full max-w-md">
        <h3 class="font-bold mb-4">Edit Subjek</h3>
        <form id="editForm" method="POST">
            <input id="editName" name="name" required class="w-full border p-2 mb-4 rounded">
            <div class="flex justify-end gap-2">
                <button type="button" onclick="closeEditModal()">Batal</button>
                <button class="bg-blue-600 text-white px-4 py-2 rounded">Update</button>
            </div>
        </form>
    </div>
</div>

<%- include('partials/footer') %>

<script>
    const addModal = document.getElementById('addModal');
    const editModal = document.getElementById('editModal');
    const editForm = document.getElementById('editForm');
    const editName = document.getElementById('editName');

    function openAddModal() {
        addModal.classList.remove('hidden');
        addModal.classList.add('flex');
    }

    function closeAddModal() {
        addModal.classList.add('hidden');
        addModal.classList.remove('flex');
    }

    function openEditModal(button) {
        const id = button.dataset.id;
        const name = button.dataset.name;

        editForm.action = `/admin/subjects/edit/${id}`;
        editName.value = name;

        editModal.classList.remove('hidden');
        editModal.classList.add('flex');
    }

    function closeEditModal() {
        editModal.classList.add('hidden');
        editModal.classList.remove('flex');
    }
</script>